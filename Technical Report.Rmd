---
title: "Techincal Report - Meetup"
author: "Victoria and Ian"
date: "12/14/2017"
output: pdf_document
---

```{r, message=FALSE, warning=FALSE}
require(tidyverse)
require(jsonlite)
require(httr)
require(devtools)
require(jsonlite)
require(dplyr)
require(readr)
library(shiny)
library(shinyjs)
library(leaflet)
library(maps)
require(ggmap)
require(mosaic)

#read in the data sets
ny <- read_csv("data/meetup_groupsNYlocation.csv",  col_names = FALSE)
bo <- read_csv("data/MA.csv", col_names= FALSE)
ch <- read_csv("data/NC.csv", col_names=FALSE)
ha <- read_csv("data/CT.csv", col_names=FALSE)

#Function to rename columns for each dataset
colnames(ny)[1] <- "city"
colnames(ny)[2] <- "group_name"
colnames(ny)[3] <- "created"
colnames(ny)[4] <- "category"
colnames(ny)[5] <- "members"
colnames(ny)[6] <- "details"
colnames(ny)[7] <- "lat"
colnames(ny)[8] <- "long"

colnames(bo)[1] <- "city"
colnames(bo)[2] <- "group_name"
colnames(bo)[3] <- "created"
colnames(bo)[4] <- "category"
colnames(bo)[5] <- "members"
colnames(bo)[6] <- "details"
colnames(bo)[7] <- "lat"
colnames(bo)[8] <- "long"

colnames(ha)[1] <- "city"
colnames(ha)[2] <- "group_name"
colnames(ha)[3] <- "created"
colnames(ha)[4] <- "category"
colnames(ha)[5] <- "members"
colnames(ha)[6] <- "details"
colnames(ha)[7] <- "lat"
colnames(ha)[8] <- "long"

colnames(ch)[1] <- "city"
colnames(ch)[2] <- "group_name"
colnames(ch)[3] <- "created"
colnames(ch)[4] <- "category"
colnames(ch)[5] <- "members"
colnames(ch)[6] <- "details"
colnames(ch)[7] <- "lat"
colnames(ch)[8] <- "long"


#top categories based on membership count
top10 <- function(data) {
  data %>%
    group_by(category, city) %>%
    summarize(members_tot = sum(members), topgroup=max(members))  %>%
    arrange(desc(members_tot)) %>%
    head(10)
}
 chtop10<-top10(data=ch)
 hatop10<-top10(data=ha)
botop10<-top10(data=bo)
nytop10<-top10(data=ny) 
alltop10<-cbind(chtop10, hatop10, botop10, nytop10)





topcatbymember<-function(x){ggplot(data=x, aes(x=reorder(category, members_tot), y=members_tot))+geom_bar(stat="identity", aes(fill=topgroup)) +coord_flip()+ylab("Total Members")+xlab("Category")+scale_fill_continuous(name="top group membership")
}

#Graphic of top 10 categories (by membership count) across all 4 cities<-this isn't working
topcatbymember(alltop10)+facet_wrap(~city)
ggplot(data=chtop10, aes(x=reorder(category, members_tot), y=members_tot))+geom_bar(stat="identity", aes(fill=topgroup)) +coord_flip()+ylab("Total Members")+xlab("Category")+scale_fill_continuous(name="top group membership")


```


```{r}
#creates df topics with number of groups per topic 
mostgroups<- function(data){
  topics <-data %>% 
  group_by(category) %>% 
  summarise(group_tot = n()) %>% 
  arrange(desc(group_tot));topics %>% 
    head(10)
}

chgroups<-mostgroups(ch)
nygroups<-mostgroups(ny)
bogroups<-mostgroups(bo)
hagroups<-mostgroups(ha)



```

Evaluation Criteria:

 Information From Data: Did we learn anything meaningful from this project? Has the original question been answered? Are the chosen analyses appropriate for the variables/relationships under investigation, and are the assumptions underlying these analyses met? Are the analyses carried out correctly? Did the group make appropriate conclusions from the analyses, and are these conclusions justified?

Wrangling: How challenging was the project? Were the data particularly large, complex, and/or messy? Did the data come in an obscure format? Was a scraper or API necessary to acquire the data? Were any elements from outside the coursework necessary to complete the project?


Graphics: How well were the graphical elements of the project designed? Were they clunky or elegant? Was a truly original view of the data presented? Were any interactive elements usable?

Originality/Interest: Is the topic original, interesting, and substantial – or is it trite, pedantic, and trivial? How much creativity, initiative, and ambition did the group demonstrate? Is the basic question driving the project worth investigating, or is it obviously answerable without a data-based study?

) Write-Up: How effectively does the write-up communicate the goals, procedures, and results of the study? Are the claims adequately supported? Does the writing style enhance what the group is trying to communicate? How well is it edited? Are the statistical claims justified? Are text and analyses effectively interwoven? Clear writing, correct spelling, and good grammar are important.

Required for A) Self-Learning: Were any elements from outside the coursework necessary to complete the project?


** we need to establish that when we say events we mean group base location. Also that when a group is created and a hometown is chosen, the latitudes and longitudes are as user specified. Ex) saying your group is in queens along with 100 other people means there will be 101 groups at the same latitude and longitude. That is why our markers overlap!!** In the limitations maybe?

** I have been using words like group, event, and category interchangeaably and really poorly**.

**what code should we use..?**

**we also need to build like a story like flow: abstract, 4 screenshots of the maps, intro etc.**


> Abstract: a short, one paragraph explanation of your project. The abstract should be no more than six sentences. It should summarize what you studied and what you found. It need only convey a general sense of what you actually did (not all of the steps and iterations). The purpose of the abstract is to give a prospective reader enough information to decide if they want to read the full paper. A draft of this component of the report will be submitted (see Project summary in Timeline).


This report is an analysis of MeetUp groups in 4 cities along the coast of the United States. Using data generated from Meetup group creations, we mapped the top 4 categories for New York (n=`r tally(ny) `), Hartford (n=`r tally(ha) `), Boston (n=`r tally(bo) `), and Charlotte (n=`r tally(ch) `). Our findings indicated that socializing, tech, and career business were the three most consistent meetup up categories within these cities. 


> Introduction: an overview of your project. In a few paragraphs, you should explain clearly and precisely what your research question is, why it is interesting, and what contribution you have made towards answering that question. You should give an overview of the specifics of your model, but not the full details. Most readers never make it past the introduction, so this is your chance to hook the reader, and is in many ways the most important part of the paper!

Today, seven-in-ten Americans use social media as a tool for engaging with their surrounding communities. The increased use of social networks, has created an abundance of data that can be used in the analysis of social trends and habits. To help give a better idea of this information's potential use, let us imagine a scenario: Victoria is a recent graduate who has been offered jobs in several cities. In deciding where to move, she **would like a better sense the social habits and trends** of each respective city. Unbeknownst to many, she is a talented latin dancer and would like to move to a city that has multiple meetups where she would be able to meet new people to dance with. When deciding to move to a new city, it is important to understand the social climate of an area. This is especially important if you have no prior knowledge of **events**, **an area**, or **its culture**, or if you're just trying to learn something new. Meetup is an app someone like Victoria would likely use in search of her future friends. However one shortcoming of Meetup is that there are no summary statistics presented on groups or categories within an area.

**Research Question:** The goal of our project was to create graphics that displayed the most popular categories of Meetup events in various cities along the east coast. We were also hoping to additionally map the events to give better geospacial data of where certain types of events would probably be located. 

**Overview of our model:** First we scraped live group data from MeetUp's API for 4 cities and saved them as csv with a python and an R call. We grouped the data based on group category and count membership within each category and group number in each category in each of the four cities. We also merged latitude and longitude data from the groups, and we imposed groups on a map using the Leaflet package in R.

> Data: a brief description of your data set. What variables are included? Where did they come from? What are units of measurement? What is the population that was sampled? How was the sample collected? You should also include some basic univariate analysis. Here is where you should read in the data, derive new variables, and fit models.

Our data sets are composed of geographical and summary information for each of the 4 cities. Complete definitions of our variables are as follows:

* **city**: the name of the city 
* **group_name**: the name of the group 
* **created**: time the group was created in milliseconds since the epoch
* **category**: umbrella category groups fall into (dancing, tech)
* **members**: total number of members
* **details**: focus of the group (salsa dancing, robot battling)
* **lat**: latitude of **events**
* **long**: longitude of **events**


Our population is meetup groups created at the time we ran our api call for each city. 

A list of categories has been provided below.
```{r}
unique(ch$category) 
```



> Results: an explanation of what your model tells me about the research question. You should interpret coefficients in context and explain their relevance. What does your model tell me that I didn’t already know before? You may want to include negative results, but be careful about how you interpret them. For example, you may want to say something along the lines of: “we found no evidence that explanatory variable x is associated with response variable y”, or “explanatory variable x did not provide any additional explanatory power above what was already conveyed by explanatory variable z.” On other hand, you probably shouldn’t claim: “there is no relationship between x and y.”

> Diagnostics: a full diagnostic analysis of your model, with interpretation of Figures that you provide.

The first step was creating an api call to get the variables for different events or groups. We made an API call through python and R code. It used an html request to obtain JSON data.We got the JSON in two ways. First we did this by running python in our bash terminal, but this API call was not set to pull specific open events. The other method we used was through creating a function in R that pulled open events. However, when we got the events information, none of the events had latitude and longitude data associated, so we could not map the events. Because we thought the groups would be a better summary of what types of events are popular in a city, and because we obtained more data with the python groups call, we elected to use the python code to run our analyses. We have both calls in this repo.

After we got the data, we grouped the different data by category and arranged the top 10 categories through a barplot. We also used the gradient of color to describe what the biggest groups in each membership category are. Another way we visualized this was with a plot of number of groups, where we tallied group amount.  

* sublime python text then what it does (victoria steals the show)
* how we added latitude and longitude of group locations (hometown)
* mapped with Leaflet

> Conclusion: a summary of your findings and a discussion of their limitations. First, remind the reader of the question that you originally set out to answer, and summarize your findings. Second, discuss the limitations of your model, and what could be done to improve it. You might also want to do the same for your data. This is your last opportunity to clarify the scope of your findings before a journalist misinterprets them and makes wild extrapolations! Protect yourself by being clear about what is not implied by your research.

In New York, the top categories by membership count were socializing, tech, career, and outdoors/adventure. There were significant differences between the total amount of people who were in socializing groups than the total amount of people in tech groups, as evidenced by the significant difference in proportions of people in socializing groups versus in tech groups. When we ran a t test for difference in proportions we found that there were at least one significant difference in proportions. 
```{r}
topcatbymember(nytop10)+labs(title = "NY top categories by membership")
ny %>% summarise(totalgroupmembership=sum(members))
is_socializing<-c(318613,219107)
totalny<-c(1835516, 1835516)
prop.test(is_socializing,totalny)

#trying to make a vector to figure out if there are differences between all the groups
ny_vector<-nytop10 %>% summarise(totalgroupmembership=sum(members_tot), failures=1835516-totalgroupmembership) %>% arrange(desc(totalgroupmembership))
nyproptest<-ny_vector %>% select(totalgroupmembership, failures)
nyproptest<-data.matrix(nyproptest, rownames.force = NA)
stats::prop.test(nyproptest)
```

In Hartford, the top categories were outdoors/adventure, socializing, and health/wellbeing. From the coloring of the categories, we can tell that the outdoors/adventure category has the largest group, and the rest of the groups largest membership is smaller. This means that there is one large group for outdoors/adventure versus many smaller groups for socializing. 
```{r}
topcatbymember(hatop10)+labs(title = "Hartford top categories by membership")

```

In Boston, the top categories were socializing, tech, outdoors/adventure, and career/business.Interestingly, the biggest tech group is bigger than the biggest socializing group, suggesting a bigger tech meetup and relatively smaller socializing meetups.

```{r}
topcatbymember(botop10)+labs(title = "Boston top categories by membership")

```

In Charlotte, the top categories were socializing, career/business, tech, and outdoors/adventure. The biggest group is the in the category of food and drink, which is interesting because it suggests that most of the food groups meet under one group. The top four categories in Charlotte are all made of many smaller groups.  
```{r}
topcatbymember(chtop10)+ labs(title = "Charlotte top categories by membership")

```

In the two smaller cities (Hartford and Charlotte) career/business groups were most prevalent. This was unlike New York and Boston where socializing and tech were the respective **top groups**. 

Overall, it is quite intuitive why tech, career, and socializing were the most prevalent groups amongst these cities. The fact that Meetup's API is so well documented suggests that a large base of users in meetups are tech. It is also understandable that bigger cities have bigger tech scenes.

Limitations: Our initial goal was to create a Shiny map that displayed the top **events** in each city. We intended to have a live pull of reservations from Meet Up's API. We had to settle for groups hometown locations however because our R API call did not supply us with the latitude and longitude for different events. Additionally the plotting of groups provided and source of frustration during our project. We noticed that several markers overlapped. We originally though this was because they were hosted in the same locations. **Maybe leaflet with cluster effect showing all tech groups at one location**. When we remembered that these were group locations in which the groups were created, we were slightly more suspicious as to why so many overlapped. **Maybe a leaflet showing a red marker on a point, and a green marker on the same point**. We tallied the unique latitudes and longitudes using group_by, summarize calls, and found there were many overlapping markets. After double checking the meetup group creation website, we concluded this was a result of MeetUp's location services. When making a group, users are asked for a 'hometown' or place where the group was created. The latitude and longitude are only as precise as one specifies. Imagine 10 groups being created in washingston heights (different categories) all getting mapped to the same location. Thus overlapping markers made the graphic a somewhat inaccurate representation of top categories. 

Our aspirations were sadly cut short due to a several errors with code translation. However, bcause of the work we've done with the API call and getting open events and groups, it would be nice if some one could continue our work through making an R package that pulls this data, like TwittR but MeetupR. Right now, the only packages that exist pull the events from a group that you are part of, rather than summary stats from groups and all the events.  
